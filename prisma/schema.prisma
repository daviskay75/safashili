// Psychology Practice Database Schema
// Prisma schema for Safa Shili's psychology practice website

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Contact form submissions and newsletter signups
model Contact {
  id            String   @id @default(cuid())
  type          String   // 'contact' | 'newsletter' | 'booking'
  email         String
  firstName     String
  lastName      String?
  phone         String?
  source        String   // Page where contact was made
  status        String   @default("active") // 'active' | 'archived' | 'deleted'
  gdprConsent   Boolean  @default(false)
  gdprConsentDate DateTime @default(now())
  lastActivity  DateTime @default(now())
  tags          String   // JSON array of tags
  notes         String?
  data          String   // JSON data specific to contact type
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("contacts")
}

// Appointment bookings
model Appointment {
  id                String   @id @default(cuid())
  patientEmail      String
  patientName       String
  date              String   // YYYY-MM-DD format
  time              String   // HH:MM format
  duration          Int      // minutes
  consultationType  String   // 'cabinet' | 'domicile' | 'groupe' | 'distance'
  status            String   @default("pending") // 'pending' | 'confirmed' | 'cancelled'
  isFirstConsultation Boolean @default(false)
  reasonForConsultation String?
  medicalHistory    String?
  emergencyContact  String?  // JSON: {name, phone}
  calendarEventId   String?  // Google Calendar event ID
  notes             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("appointments")
}

// GDPR deletion requests
model GdprRequest {
  id               String   @id @default(cuid())
  email            String   @unique
  requestDate      DateTime @default(now())
  reason           String
  processed        Boolean  @default(false)
  processedAt      DateTime?
  contactsDeleted  Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@map("gdpr_requests")
}

// Analytics events for business intelligence
model AnalyticsEvent {
  id          String   @id @default(cuid())
  eventType   String   // 'page_view' | 'form_submit' | 'contact_submit' | etc.
  eventData   String?  // JSON data
  page        String
  sessionId   String
  userAgent   String?
  ipAddress   String?
  timestamp   DateTime @default(now())
  createdAt   DateTime @default(now())

  @@map("analytics_events")
}
